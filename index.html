<html>


    <head>
        <meta charset="utf-8">    <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="">
        <link rel="icon" href="favicon.ico">


        <title>Starter Template for Bootstrap</title>

        <!-- Bootstrap core CSS -->
        <link href="css/bootstrap.css" rel="stylesheet">
        <link href="css/normalize.css" rel="stylesheet">
        <!-- Custom styles for this template -->
        <!--    <link rel='stylesheet prefetch' href='http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css'>-->

        <!--        <link href="css/styles.css" rel="stylesheet">-->

        <link rel="stylesheet" href="css/styles.css">
        <!-- <script src='js/index.js'></script> -->
        <script src="https://cdn.firebase.com/js/client/2.3.0/firebase.js"></script>
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
            <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->
    </head>

    <body>



        <div class="navbar navbar-inverse navbar-fixed-top" role="navigation" >
            <div class="container">
                <div class="navbar-header">

                    <ul class="nav nav-tabs">
                        <li class="active"><a data-toggle="tab" href="#home" class="glyphicon glyphicon-home"> Home</a></li>
                        <li><a data-toggle="tab" href="#menu1" class="glyphicon glyphicon-book"> About</a></li>
                        <li><a data-toggle="tab" href="#menu2" class="glyphicon glyphicon-phone-alt"> Contact</a></li>

                    </ul>


                </div><!--/.nav-collapse -->
                <div class="navbar navbar-right navbar">
                    <form class="form-horizontal" role="form" >
                        <div class="form-group">
                            <input id="searchbox" type="search" class="form-control-static has-success has-feedback">


                            <btn class="form-control-static btn btn-default glyphicon glyphicon-search" />
                        </div>
                    </form>

                </div>


            </div>


            <button type="button" class="btn btn-default btn-lg glyphicon glyphicon-log-in" id="myBtn"> Login</button>
            <button type="button" class="btn btn-default btn-lg glyphicon glyphicon-log-in" id="logoutBtn"> Logout</button>
            <label id="loginStateMsg">Please Log in</label>
        </div>


        <div class="container" >

            <!--start of main page body content-->
            <div class="row">
                <!--Static left column-->

                <div class="col-sm-2">

                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h2>Hello and Welcome</h2>

                        </div>

                        <div class="panel-body">
                            <div class="well well-sm">Small Well
                                <p>Some content.</p>
                            </div>
                        </div>
                    </div>


                </div>
                <!--Dynamic middle column-->
                <div class="col-sm-8 >

                     <div class="starter-template">
                     <div class="tab-content">
                        <div id="home" class="tab-pane fade in active">
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <h1 class="glyphicon glyphicon-home"> Home</h1>
                                </div>
                                <div id="leftpanel" class="panel-body">
                                    <div id="leftwell" class="well well-lg">

                                        <div  class="panel panel-default" >
                                            <div id="loginDiv" class="table table-responsive" title="Log on..."   >


                                                <div id="loginModal" >
                                                    <div class="container">

                                                        <div class="modal fade" id="myModal" role="dialog">
                                                            <div class="modal-dialog">


                                                                <div class="modal-content">
                                                                    <div class="modal-header" style="padding:35px 50px;">
                                                                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                                                                        <h4><span class="glyphicon glyphicon-lock"></span> Login</h4>
                                                                    </div>
                                                                    <div class="modal-body" style="padding:40px 50px;">
                                                                        <form role="form" >
                                                                            <div class="form-group">
                                                                                <label for="userID"><span class="glyphicon glyphicon-user"></span> Username</label>
                                                                                <input type="text" class="form-control" id="userID" placeholder="Enter email">
                                                                            </div>
                                                                            <div class="form-group">
                                                                                <label for="password"><span class="glyphicon glyphicon-eye-open"></span> Password</label>
                                                                                <input type="text" class="form-control" id="password" placeholder="Enter password">
                                                                            </div>
                                                                            <div class="checkbox">
                                                                                <label><input type="checkbox" value="" checked>Remember me</label>
                                                                            </div>
                                                                            <button id="loginBtn" type="button" class="btn btn-success btn-block"><span class="glyphicon glyphicon-off"></span> Login</button>
                                                                        </form>
                                                                    </div>
                                                                    <div class="modal-footer">
                                                                        <button type="submit" class="btn btn-danger btn-default pull-left" data-dismiss="modal"><span class="glyphicon glyphicon-remove"></span> Cancel</button>
                                                                        <p>Not a member? <a id="getSignupBtn" href="#" data-dismiss="modal" >Sign Up</a></p>







                                                                        <p>Forgot <a href="#">Password?</a></p>
                                                                    </div>
                                                                </div>

                                                            </div>
                                                        </div> 
                                                    </div>
                                                </div>


                                                <!--            <h4><span class="glyphicon glyphicon-lock"></span> Sign up!</h4>-->
                                            </div>
                                            <!--                         End login -->

                                            <!--                        Start sign up -->

                                            <div id="signupModal" >
                                                <div class="container">

                                                    <div class="modal fade" id="signup" role="dialog">
                                                        <div class="modal-dialog">


                                                            <div class="modal-content">
                                                                <div class="modal-header" style="padding:35px 50px;">
                                                                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                                                                    <h4><span class="glyphicon glyphicon-user"></span> Sign up!</h4>
                                                                </div>
                                                                <div class="modal-body" style="padding:40px 50px;">
                                                                    <form role="form" >
                                                                        <div class="form-group">
                                                                            <label for="userID"><span class="glyphicon glyphicon-user"></span> Username</label>
                                                                            <input type="text" class="form-control" id="userID" placeholder="Enter email">
                                                                        </div>
                                                                        <div class="form-group">
                                                                            <label for="password"><span class="glyphicon glyphicon-eye-open"></span> Password</label>
                                                                            <input type="text" class="form-control" id="password" placeholder="Enter password">
                                                                        </div>

                                                                        <button id="signupBtn" type="button" class="btn btn-success btn-block"><span class="glyphicon glyphicon-off"></span> Sign up!</button>
                                                                    </form>
                                                                </div>
                                                                <div class="modal-footer">
                                                                    <button type="submit" class="btn btn-danger btn-default pull-left" data-dismiss="modal"><span class="glyphicon glyphicon-remove"></span> Cancel</button>

                                                                </div>
                                                            </div>

                                                        </div>
                                                    </div> 
                                                </div>
                                            </div>               

                                            <form id="form1" >
                                                <tr>  
                                                    <td>First name</td>
                                                    <td>  <input id = "firstname" type="text" class="landlord" /></td>
                                                </tr></br>
                                                <tr>
                                                    <td>Last Name</td>
                                                    <td> <input id = "lastname" type="text" class="landlord" /></td>
                                                </tr></br>

                                                <tr>
                                                    <td>DOB</td> 
                                                    <td> <input type="datetime-local" id = "datebirth" type="text" class="landlord" /></td>

                                                </tr></br>
                                                <tr>
                                                    <td>Rating</td>
                                                    <td> <input id = "rating" type="range" class="landlord" min="1" max="10"/></td>

                                                </tr>
                                                <tr>
                                                    <td>Company</td>
                                                    <td><input id="company"  class="landlord" /></td>

                                                </tr></br>
                                                <tr>
                                                    <td>Comments</td>
                                                    <td> <input id = "comments" type="" class="landlord" /></td>

                                                </tr></br>

                                                <button id="subBtn" class="button" onclick="saveTbl()">Submit</button>
                                            </form>
                                        </div>



                                        <div id="landlordtblHeading" class="panel  panel-info">
                                            <div id="lltblMessage" class="panel"></div>
                                            <!-- Default panel contents -->
                                            <div class="panel-heading panel-title">Landlords</div>

                                            <!-- Table -->
                                            <!--                        F                        <table id="landlordstbl" class="table">
                                                                                                ...
                                                                                            </table>-->

                                            <br/>
                                            <!--                                                <button id="addBtn" type="button"  > Add Landlord</button>-->

                                            <div class="tab-pane">
                                                <div class="tab-content active">
                                                    <input type="button" id="addBtn"   width="10" class="glyphicon-plus-sign btn-default" value="+">Add Landlord</input> </br>

                                                    <table id="landlordstbl" title="Landlords" class="table-responsive">
                                                        <thead>
                                                        <th>firstname</th>
                                                        <th>lastname</th>
                                                        <th>datebirth</th>
                                                        <th>company</th>
                                                        <th>rating</th>
                                                        <th>comments</th>
                                                        </thead>
                                                        <tbody>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>



                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="menu1" class="tab-pane fade">
                            <h1 class="glyphicon glyphicon-book"> About</h1>
                                                            <p>Some content in menu 1.</p>
                        </div>
                                                    <div id="menu2" class="tab-pane fade">
                                                    <h1 class="glyphicon glyphicon-phone-alt"> Contact</h1>
                            <p>Some content in menu 2.</p>
                        </div>
                                                    </div>

                </div>


            </div>
                                                            <!--Static right column-->
            <div class="col-sm-2">
                <div class="panel panel-default">
                                                    <div class="panel-heading">
                        <h2>Hello and Welcome</h2>
                                                            </div>
                    <div class="panel-body">
                                                    <p>Some content.</p>
                    </div>
                </div>

            </div>
                                                            </div>




    </div><!-- /.container -->


    <!-- Bootstrap core JavaScript
    ================================================== -->
                                                    <!-- Placed at the end of the document so the pages load faster -->
                                                            <script type="text/javascript" src="js/jquery-2.1.4.min.js"></script> 		
    <script src="js/bootstrap.min.js"></script>
                                                    <!--        <script type="text/javascript" src="js/ajax-cache.googlecode.com_files_ajaxCache-0.2.1.min.js"></script>-->
                                                            <script type="text/javascript" src="js/jquery.dynatable.js"></script>
                                                    <!--        <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/r/bs/dt-1.10.9/datatables.css"/>-->

                                                            <!--        <script type="text/javascript" src="https://cdn.datatables.net/1.10.9/js/jquery.dataTables.min.js"></script>-->
                                                    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
                                                    <!--    <script src="js/ie10-viewport-bug-workaround.js"></script>-->

                                                            <script>
                                                    $(document).on("ready", function () {

                                                            $("#messageList").children("span").bind("click", function () {
                                                    $.when(!$("#messageList").has("li")).then(function () {
                                                            $("#messageList").hide("slow");
                                                            $("#messageList").removeClass("fade in", "fade", "in").addClass("fade out");
                                                            });
                                                    $.when($("#messageList").has("li")).then(function () {
                                                            $("#messageList").show("slow");
                                                                $("#messageList").removeClass("fade out", "fade", "out").addClass("fade in");
                                                            });
                                                        });
                                                            $("#footer #messageList").on("click", "span", function () {
                                                            console.log("it works!");
                                                            $.when(!$("#messageList").has("li:last-of-type")).then(function () {
                                                            $("#messageList").hide("slow");
                                                            $("#messageList").removeClass("fade in", "fade", "in").addClass("fade out");
                                                            });
                                                            });
                                                            $("*").on("mouseenter", $("body"), function () {
                                                    console.log("message Added");
                                                            if ($("#messageList > li").length > 0) {
                                                            console.log("I have a span");
                                                    $("#messageList").show("slow");
                                                    //       alertQueue(this);
                                                    $("#messageList").removeClass("fade out", "f ade", "out").addClass("fade in");
                                                            }


                                                            });
//    
                                                        //            $.when(!$("#messageList").has("li")).then(function() {
                                                            // $("#messageList").hide("slow");
//});
//     
                                                            //   $.when($("#messageList").has("li")).then(function() {
                                                            // $("#messageList").show("slow");


                                                    //     $("#messageList").hide("slow");
                                                            // $.when(!$("#messageList").has("li")).then (function() {
                                                            // $("#messageList").hide("slow");
//});

                                                    //   $.when($("#messageList").has("li")).then(function() {
                                                    // $("#messa geList").show("slow");
                                                    //});                                    
                                                            $("#form1").hide();
                                                            $("#addBtn").on("click", function () {
                                                            showHideForm();
                                                        });
                                                    var ref = rootRef;
                                                            countLoads++;
                                                       if (countLoads > 1) {
                                                            handleMessage();
                                                    }

                                                            if (authData) {
                                                            $("#logoutBtn").show();
                                                            $("#myBtn").hide();
                                                            $("#loginStateMsg").text("Welcome, " + authData.password.email + "! Logged In")
                                                            user.email = authData.password.emaill;
                                                            user.uid = authData.auth.uid
                                                            user.alerts = [];
                                                            } else {

                                                            $("#logoutBtn").hide();
                                                            $("#myBtn").show();
                                                                    $("#loginStateMsg"). text("Welcome, Please log in or sign up Guest! Logged  out")

                                                                            }


                                                         $("#myBtn" ).on("click", function () {
                                                                    console.log("Login button clicked");
                                                                    $("#loginModal").css("visibility", "visible");
                                                             $("#myModal").modal();
                                                            $("#myModal").css("visibility", "visible");
                                                        });
                                                        $("#myBtn").click(function () {
                                                            console.log("Login button clicked");
                                                            $("#loginModal").modal();
                                                        });
//    



                                                        saveSession();

                                                        function   saveSession() {
                                                            if (authData === null || 'undefined') {
                                                                console.log("no session, guest user!");
                                                                            console.log("User not logged in, no session data saved");

                                                                            } else {
                                                                            var uiddb = users.child(authData.uid).set(authData);

                                                                            users.on("value", function (snapshot) {
                                                                            userData = snapshot.val();
                                                                    if (authData !== null) {

                                                                            if ($(userData).index(user.uid) === null || 'undefined') {
                                                                    user = snapshot.val()[user.uid];

                                                                            var saveuid = user.uid;
                                                                            user = authData;
                                                                            user.uid = saveuid;

                                                                            //create and push the authenticated user in db\
                                                                            users.child(user.uid).set(user);

                                                                    } else {

                                                            user = userData[user.uid];
                                                                        }

                                                    } else {
                                                            //this user is not authenticated
                                                            console.log("this user is not authenticated, guest user");

                                                            }



                                                            //console.log("Logged in and alerts should be set for this user" + user.uid);



                                                            });

                                                            }
                                                            }



//end document.ready
//function() {                                  



                                                            
//}

                                                    });
                                                    var alertMessage;
                                                    var alertMsg = $("#messageList").clone();
                                                    var clickcount = 0;
                                                            var rooturl = "https://slumlordrateboard.firebaseio.com";
                                                    var authData = {};
                                                    var error;
                                                            var inModal = false;
                                                            //var Firebase = require("firebase");
                                                            var landlordObj = {firstname: "Bob", lastname: "Reynold", datebirth: "07/21/1985", company: "JLB Construction", rating: 7.2, comments: ["This guy sucks!", "yeah right, he is the best!", "I think he is over rated. I paid a lot of money!!$$"]};
                                                            var lltwo = {firstname: "Ricky", lastname: "Hatton", datebirth: "07/21/1985", company: "JLB Construction", rating: 7.2, comments: ["This guy sucks!", "yeah right, he is the best!", "I think he is over rated. I paid a lot of money!!$$"]};
                                                    var dynaTbl = {};
                                                    var jsonTestObj = {landlords: [landlordObj, lltwo]};
                                                    var llproto = {firstname: "", lastname: "", datebirth: "", company: "", rating: 0.0, comments: []};
                                                            // var llproto = {firstname: "", lastname: "", datebirth: "", company: "", rating: 0.0, comments: []};
                                                            var dynoTest = [{firstname: "Bob", lastname: "Reynold", datebirth: "07/21/1985", company: "JLB Construction", rating: 7.2, comments: ["This guy sucks!", "yeah right, he is the best!", "I think he is over rated. I paid a lot of money!!$$"]}, {firstname: "Ricky", lastname: "Hatton", datebirth: "07/21/1985", company: "JLB Construction", rating: 7.2, comments: ["This guy sucks!", "yeah right ,  he is the best!", "I think he is over rated. I paid a lot of money!!$$"]}];                                                     var highestIndex = 0;
                                                            var rootRef = new Firebase('https://slumlordrateboard.firebaseio.com');
                                                            var db = rootRef.child("slumlordrateboard");
                                                            var landlords = db.child("landlords");
                                                            var users = db.child("Users");
                                                            var alerts = {};
                                                            var mydata = {};
                                                    var dbJava = {};
                                                            var landlordsJava = {};
                                                            var rowindex = landlordsJava.length;
                                                            var submittedRowIndex = 0;
                                                            var countLoads = 0;
                                                            var dbJava = {};                                                     var landlordsJava = {};
                                                            var table = $("#landlordstbl");
                                                    var currentState = {};
                                                            var messages = landlords.child("messages");
                                                            var lastRowPicked = messages.child("lastRow");
                                                            var rowindex = {}
                                                            var rowData = {};
                                                            var rowval = {};
                                                    var matched;
                                                            var all;
                                                    var currLastIndex;
                                                            var user = {};                                                     var userData = {};
                                                            var allIndexes = [];
                                                            db.on("value", function (snapshot) {
                                                            console.log("On read db.on: " + snapshot.val());
                                                            dbJava = snapshot.val();
                                                                    }, function (errorObject) {
                                                                    console.log("The read failed: " + errorObject.code);
                                                    });
                                                            landlords.on("value", function (snapshot) {
                                                            landlordsJava = snapshot.val();
                                                                    console.log("on read landlords.on: " + landlordsJava);
                                                            dynaTbl = $('#landlordstbl').dynatable({
                                                            dataset: {records: landlordsJava

                                                            }
                                                            }).data('dynaTbl');
                                                        //stateKeeper.needsAddedMessage =true;
                                                            }, function (errorObject) {
                                                    console.log("The read failed: " + errorObject.code);
                                                    });
                                                    //on table load sort table by last name
                                                    $('#landlordstbl').bind('dynatable:init', function (e, dynatable) {
                                                            // dynatable.clear();

                                                        // dynatable.records.resetOriginal();
                                                            //dynatable.records.updateFromJson();
                                                            dynatable.sorts.clear();
                                                            dynatable.sorts.add('lastname', 1); // 1=ASCENDING, -1=DESCENDING
                                                                    dynatable.process();
//
//

                                                                    });
                                                    lastRowPicked.on("value", function (snapshot) {
                                                            rowval = snapshot.val();
                                                            llproto = snapshot.val();
                                                            console.log("last row: " + JSON.stringify(rowval));
                                                            }, function (errorObject) {
                                                            console.log("The read failed for messages: " + errorObject.code);
                                                                    });
                                                                    messages.on("value", function (snapshot) {
                                                        currentState = snapshot.val();
                                                            console.log("CURRENT STATE OBJECT: " + JSON.stringify(currentState));
                                                            if (currentState.needsAddedMessage === true) {
                                                            stateKeeper(currentState);
                                                            }
                                                            if (currentState.needsDeletedMessage === true) {
                                                            stateKeeper(currentState);
                                                        }
                                                            }, function (errorObject) {
                                                            console.log("The read failed for messages: " + errorObject.code);
                                                    });
                                                                    landlords.on("value", function (snapshot) {
                                                                    landlordsJava = snapshot.val();
                                                            console.log("on read landlords.on: " + landlordsJava);
                                                            dynaTbl = $('#landlordstbl').dynatable({
                                                            dataset: {records: landlordsJava

                                                            }
                                                            }).data('dynaTbl');
                                                            }, function (errorObject) {
                                                            console.log("The read failed: " + errorObject.code);
                                                    });
                                                            $(landlords).on("value", function () {

                                                            console.log("Form 1 has changed");
                                                        rowindex = (landlordsJava.length) + 1;
                                                            // var llproto= new llproto();                                                             llproto.firstname = $("#firstname").text();
                                                            llproto.lastname = $("#lastname").text();
                                                            llproto.datebirth = $("#datebirth").text();
                                                            llproto.rating = $("#rating").text();
                                                            llproto.company = $("#company").text();
                                                            var commentTxt = $("#comments").text();
                                                            llproto.comments = commentTxt.split(",");
                                                        landlordsJava = snapshot.val();
                                                            console.log("on read landlords.on: " + landlordsJava);
                                                    dynaTbl = $('#landlordstbl').dynatable({
                                                    dataset: {records: landlordsJava

                                                            }
                                                    }).data('dynaTbl');
                                                    }, function (errorObject) {
                                                            console.log("The read failed: " + errorObject.code);
                                                    });
                                                            landlords.on("child_changed", function (snapshot) {
                                                                    landlordsJava = snapshot.val();
                                                                    console.log("on read landlords.on child changed: " + landlordsJava);
                                                            dynaTbl = $('#landlordstbl').dynatable({
                                                            dataset: {records: landlordsJava

                                                            }
                                                            }).data('dynaTbl');                                                         mydata = eval(landlordsJava);                                                     }, function (errorObject) {
                                                            console.log("The read failed: " + errorObject.code);
                                                            });
                                                            var ref = rootRef;
                                                            authData = ref.getAuth();
                                                    ref.onAuth(authDataCallback);

                                                            $("#logoutBtn").click(function () {
                                                    logout();
                                                    });
                                                            //require($.dynatable.js);                          



//var $records = $(dynoTest);
//   var myRecords =  JSON.stringify($records.text());
                                                            //$('#landlordstbl').dynatable({
//  dataset: {
//    records: myRecords
//  }
//});

                                                            //$('#landlordstbl').dynatable({
//  dataset:  {records:dynoTest
//      
//        }
//});




                                                            $("#landlord s tbl tbody").on('blur', "tr", function () {
//  var value = $(this).val();
                                                    if (this.value === "") {
                                                    dynaTbl.queries.remove("comments");
                                                            dynaTbl.process();
                                                        } else {
                                                    }

                                                    });
                                                            //                                                        var colSelected = {};
                                                            //                                                        $("#landlordstbl tbody").on('blur', "td", function () {
                                                            //                                                            colSelected = $(this).val();
                                                            //                                                            console.log("Column blurred " + $(colSelected).text());
//                                                        });
                                                            //                                                        var rowval = {};
//
//                                                       
                                                    //                                                        
                                                            //                                                        //update data object using table as edited saving to llproto
                                                    $("#landlordstbl tbody").on('blur', "tr", function () {
                                                    //                                                             $("div .modal-backdrop").removeClass("fade in");
                                                    //                                                         $("div .modal-backdrop").addClass("fade out");
                                                        console.log("clickcount=" + clickcount + "...inmodal = " + inModal);
                                                    // if (clickcount > 0 ? true : false && inModal === false) {
                                                            if (inModal === false) {
                                                            inModal = false;
                                                            rowval = $(this)[0];
                                                            //   for (var x = 0; x < rowval.children.length; x++) {


                                                            llproto.firstname = rowval.children[0].textContent;
                                                            llproto.lastname = rowval.children[1].textContent;
                                                            llproto.datebirth = rowval.children[2].textContent;
                                                            llproto.rating = rowval.children[4].textContent;
                                                            llproto.company = rowval.children[3].textContent;
                                                            llproto.comments = rowval.children[5].textContent.split(",");
                                                            llMatch();
                                                            lastRowPicked.set(llproto);
                                                            // landlords.child(matched).set(llproto);

                                                            //landlords.child(rowindex).set(llproto)

                                                            //  landlords.child(rowindex).set(llproto);
                                                            //  location.reload();
                                                            //  $(landlords).dom.update();
                                                            //                                                            var changes = $(this);
                                                            //                                                                console.log("A CHANGE HAS OCCURED " + "Row : " + changes.text());
                                                            currentState.needsAddedMessage = false;
                                                            currentState.needsDeletedMessage = false;
                                                            messages.set(currentState);
                                                            //  messages.set(currentState);

                                                            //                               location.reload();



                                                            //need to reload doc to show changes
                                                            //  location.reload();

                                                            //                                                var tblb = table;
                                                            //                                                var arec = JSON.stringify(tblb[0].rows);
                                                            //                                                console.log("RECORDS STRINGIFIED" + arec)
                                                            //                                                 dynaTbl = $('#landlordstbl').dynatable({
                                                            //                                                    table: {
                                                            //                                                        defaultColumnIdStyle: 'trimDash'
                                                            //                                                    },
                                                            //                                                    dataset:{records: arec }
                                                            //                                                    
                                                            //                                                   });
                                                            //tblb.records.getFromTable();

                                                            //       dynaTbl.dom.update();
                                                        }
                                                    });
                                                            //                                                       var arrJSON=[eval(llproto)];
                                                    //       
                                                            //                                                                                                     $("#landlordstbl").dynatable().updateFromJson(arrJSON);



//
//
                                                    $("#landlordstbl tbody").on('click', "tr", function () {
                                                            if (inModal === true) {

                                                    //                                                          //  clickcount = clickcount++ < 3 ? clickcount++ : 0;
                                                    if ($("#lltblMessage").hasClass("panel-success")) {

                                                    $("#closeMess").triggerHandler("click");
                                                                $("#closeMess").hide();
                                                    $("#lltblMessage").hide();
                                                            $("#lltblMessage").removeClass("panel-success");
                                                            $("#lltblMessage").text("");
                                                                inModal = false;
                                                            }
                                                            }
                                                    if (inModal === false) {
                                                    // $(".modal *").toggle();
                                                            rowval = $(this)[0];
                                                    rowindex = (rowval.rowIndex) - 1;
                                                            //rowval=llMatch();
                                                            var matchedIndex = rowval.rowIndex;
                                                            //toggleRowbg();
                                                            //setting the whole row color
                                                            rowData = $(this);
                                                            rowData.css("background-color", "yellow");
                                                            $(rowData.siblings("*")).css("background-color", "white");
                                                            rowData.prop("contentEditable", "true");
                                                            llproto.firstname = rowval.children[0].textContent;
                                                            llproto.lastname = rowval.children[1].textContent;
                                                            llproto.datebirth = rowval.children[2].textContent;
                                                            llproto.rating = rowval.children[4].textContent;
                                                            llproto.company = rowval.children[3].textContent;
                                                            var commentTxt = rowval.children[5].textContent;
                                                            llproto.comments = commentTxt.split(",");
                                                            //                                                            //var matched= 
                                                            llMatch();
                                                            lastRowPicked.set(llproto);
                                                            currentState.needsDeletedMessage = false;
                                                            messages.set(currentState);
                                                            // $(".modal *").toggle();
//
//
////     if(rowData.css("background-color")==="yellow"){
                                                            ////
////     }
////  $("#landlordstbl *:not(rowData)").css("background-color", "white");
//                                                            console.log("row selected: " + $(this).text());
//                                                            // toggleRowbg($("#landlordstbl *:not(rowData)"));
//                                                            // ... do something with `rowData`
//
//
////                                                            var rows = $(this).rows;                                                           var table = $(this).DataTable().create(table);
////
////                                                            var rowData = $(table).rows.data();     
//                                                         //   console.log("The row you selected is" + rowData);
                                                        }
////                                                        , function (errorObject) {
                                                    ////                                                          console.log("The read failed: " + errorObject.code);
////                                                        }
                                                    }
                                                    );
                                                    $("#landlordstbl tbody").on('dblclick', "tr", function () {
                                                            console.log("Double click");
                                                        clickcount = 0;
                                                    inModal = true;
                                                            if (inModal === true) {                                                             llMatch();
                                                            rowval = $(this)[0];
                                                            console.log("Double click" + rowval);
                                                            rowData = $(this);
                                                            if ($("#lltblMessage").hasClass("panel-success")) {

                                                    $("#lltblMessage").removeClass("panel-success");
                                                            $("#lltblMessage").text("");
                                                            }
                                                    // $(".modal *").toggle();
                                                    rowval = $(this)[0];
                                                            rowindex = (rowval.rowIndex) - 1;
                                                            //toggleRowbg();
                                                            //setting the whole row color
                                                            var rowData = $(this);
                                                            rowData.css("background-color", "yellow");
                                                            $(rowData.siblings("*")).css("background-color", "white");
                                                            rowData.prop("contentEditable", "true");
                                                            llproto.firstname = rowval.children[0].textContent;
                                                            llproto.lastname = rowval.children[1].textContent;
                                                            llproto.datebirth = rowval.children[2].textContent;
                                                            llproto.rating = rowval.children[4].textContent;
                                                            llproto.company = rowval.children[3].textContent;
                                                            llproto.comments = rowval.children[5].textContent.split(",");
                                                            console.log("Double click" + llproto);
                                                            llMatch();
// = commentTxt.split(",");
                                                            //var matched= landlords.child(llMatch()).set(llproto);
//                                                            // $(".modal *").toggle();
                                                            getModal();
                                                            // $("#modDetails").children(".modal").removeClass("out","fade out","in","fade").addClass("fade in");
//
////     if(rowData.css("background-color")==="yellow"){
////
////     }
////  $("#landlordstbl *:not(rowData)").css("background-color", "white");
                                                            console.log("row selected: " + $(this).text());
//                                                            // toggleRowbg($("#landlordstbl *:not(rowData)"));
//                                                            // ... do something with `rowData`
//
//
//                                                           var rows = $(this).rows;                                                          
//                                                           var table = $(this).DataTable().create(table);
//
//                                                             var rowData = $(table).rows.data();     
//                                                            console.log("The row you selected is" + rowData);
//                                                        }}
//                                                        , function (errorObject) {
//                                                        console.log("The read failed: " + errorObject.code);
////                                                        
////                                                        }
                                                    }
                                                    });
                                                            function getMessageId(snapshot) {
                                                            return snapshot.key().replace(/[^a-z0-9\-\_]/gi, '');
                                                    }



                                                    function getLandlordbyIndex(rowIndex) {

                                                    landlords.child(rowIndex).child("firstname").on("value", function (firstnameSnapshot) {
                                                    var firstnameLandlord = firstnameSnapshot.val();
                                                            var queryRef = ref.orderByChild("firstname").endAt(firstnameLandlord).limitToLast(2)
                                                            queryRef.on("value", function (firstnameLandlord) {
                                                            if (firstnameLandlord.numChildren() === 2) {
                                                                    // Data is ordered by increasing height, so we want the first entry
                                                                    firstnameLandlord.forEach(function (landlords) {
                                                                        console.log("firstname snapshot" + firstnameLandlord.key());
                                                                        // Returning true means that we will only loop through the forEach() one time
                                                                        return true;
                                                                    });
                                                                } else {
                                                                    console.log("The stegosaurus is the shortest dino");
                                                                }
                                                            });
                                                        });
                                                    }




                                                    function llMatch() {

                                                        var myLandlords = {};
                                                        //var ref = new Firebase(landlords);
//landlords.child().equalTo(llproto)
                                                        //  console.log("Got to beginning of llMatch function");


                                                        all = new Firebase('https://slumlordrateboard.firebaseio.com/slumlordrateboard/landlords');
                                                        all.orderByKey().on("value", function (snapshot) {
                                                            landlordsJava = snapshot.val();
                                                            for (var a in landlordsJava) {
                                                                console.log("INDEX IN ALL INDEXES: " + a);
////                                                                if(landlordsJava[a]>highestIndex){
                                                                if (a !== "messages") {
                                                                    highestIndex = Math.abs(a) + 1;
                                                                }
                                                            }
                                                            currLastIndex = highestIndex;
                                                            console.log("last index is " + currLastIndex);
                                                            snapshot.forEach(function (data) {

                                                                console.log("The key " + data.key() + " and value of landlord is " + JSON.stringify(data.val()));
                                                                // if(myLandlords.child(x).equalTo(llproto)){
                                                                if (JSON.stringify($(data.val())) === JSON.stringify($(llproto))) {
                                                                    matched = data.key();
                                                                    lastRowPicked.set(data.val());
                                                                    return matched;
                                                                }


                                                            }


                                                            );
                                                        });
////    for(var x in landlordsJava){
////if(myLandlords.child(x).equalTo(llproto)){
////          // if(JSON.stringify($(landlordsJava[x])) === JSON.stringify($(llproto))){
////              
////              
////            var fbName= myLandlords.child(x).name();
////            console.log("We have matched to: " + JSON.stringify($(landlordsJava[x])));
////         console.log("IndexOf result " +  matched);
////                 console.log("fbName result " +  fbName);
////
////         matched=fbName;
////         
////       break;
////   }
//                                                               currLastIndex = highestIndex;
////    
////    }
                                                        return matched;
                                                    }

                                                    function checkFBobj(ref) {

                                                        var readyNow = false;
                                                        while (readyNow === false) {
                                                            console.log("ref is: " + ref)

                                                            // Get a reference to our posts
                                                            ref = rootRef.child("slumlordrateboard/" + ref);
                                                            // Get the data on a post that has changed
                                                            ref.on("value", function (snapshot) {

                                                                if (ref === null) {

                                                                    ref.addChild("'" + ref + "'");
                                                                }


                                                                ref = snapshot.val();
                                                                readyNow = true;
                                                            });
                                                        }
                                                        return ref
                                                    }

                                                    function saveTbl() {

                                                        console.log("Form 1 has changed");
//                                                        // var nextIndex = $(landlordsJava).size();
                                                        var nextIndex = currLastIndex;
//                                                            // var llproto= new llproto();
                                                        llproto.firstname = $("#firstname").val();
                                                        llproto.lastname = $("#lastname").val();
                                                        llproto.datebirth = $("#datebirth").val();
                                                        llproto.rating = $("#rating").val();
                                                        llproto.company = $("#company").val();
                                                        var commentTxt = $("#comments").val();
                                                        llproto.comments = commentTxt.split(",");
                                                        landlords.child(nextIndex).set(llproto);
                                                        //lastRowPicked.set(llproto);

                                                        currentState.needsAddedMessage = true;
                                                        messages.set(currentState);
                                                        lastRowPicked.set(llproto);
                                                        location.reload();
                                                        // handleMessage();
                                                        showHideForm();
                                                    }

                                                    function updateModal() {

                                                        console.log("Form 1 has changed");
                                                        rowindex = (landlordsJava.length);
                                                        console.log("Getting by row index.get func: " + $("#landlordstbl").get(rowindex));
                                                        llproto.firstname = $(".modal #firstname").val();
                                                        llproto.lastname = $(".modal #lastname").val();
                                                        llproto.datebirth = $(".modal #datebirth").val();
                                                        llproto.rating = $(".modal #rating").val();
                                                        llproto.company = $(".modal #company").val();
                                                        var commentTxt = $(".modal #comments").val();
                                                        llproto.comments = commentTxt.split(",");
                                                        llMatch();
                                                        landlords.child(matched).set(llproto);
                                                        currentState.needsAddedMessage = false;
                                                        messages.set(currentState);
                                                        lastRowPicked.set(llproto);
//                                                            // handleMessage();
                                                        showHideForm();
                                                        location.reload();
                                                    }

//                                                        function saveData(mydata) {
//
//                                                            console.log("Inside saveData()");
//                                                            var llIns = mydata;
//                                                            var myObj = new Object();
//                                                            llIns = $JSON.parse(checkFBobj(".landlords"));
//                                                            landlords.set(llIns);
//                                                            //       $('#landlordstbl').each(function () {
//
//                                                            console.log($(this).attr("id"));
//                                                            //  myObj["'"+ $(this).attr("id")+"'"]= "'"+this.value+"'";
//                                                            //          myObj[$(this).attr("id")] = this.value;
//
//                                                            //llIns[llIns.length].$(this).prop("id").val=$(this).value;
//
//
//
//                                                            //       });
//                                                            console.log("myObj= " + myObj.toString());
//                                                            llIns[llIns.length] = myObj;
//                                                            //  landlords = rootRef.child("slumlordrateboard/landlords");
//                                                            landlords.push(llIns);
//
//                                                            $("#leftwell").append($(llIns).toString());
//                                                        }
//
//                                                        $('document').ready(function () {
//
//                                                            //table=  new $.fn.dataTable.Api( '#landlordstbl' );
//                                                            //       landlords.set(dynoTest);
//                                                            //var lastPull = ref.child("lastPull");
//
//                                                            // var Firebase = require("firebase");
//
//                                                            
//
//                                                        });
//
//                                                        //only to handle UI elements
//


////

////called if landlord added to table
                                                    function handleMessage() {
                                                        if (currentState.needsAddedMessage === true) {

                                                            console.log("Ready State: " + document.readyState);
                                                            $("#lltblMessage").addClass("panel panel-success alert-success");
                                                            $("#lltblMessage").before("<span id='closeMess' align='right' class='panel panel-heading btn btn-default glyphicon glyphicon-eye-close glyphicon-align-right'>");
                                                            $("#closeMess").css("display", "list-item");
                                                            $("#lltblMessage").append("Lanlord Added:</br> " + JSON.stringify(llproto));
                                                            $("#lltblMessage").after("</span>");
                                                            //     submittedRowIndex = rowindex;

                                                            $("#closeMess").on("click", function () {
                                                                $("#lltblMessage").hide();
                                                                $("#closeMess").hide();
                                                                currentState.needsAddedMessage = false;
                                                                messages.set(currentState);
                                                            });
                                                        }

                                                        if (currentState.needsDeletedMessage === true) {
                                                            $("#lltblMessage").addClass("panel panel-success alert-success");
                                                            $("#lltblMessage").before("<span id='closeMess' align='right' class='panel panel-heading btn btn-default glyphicon glyphicon-eye-close glyphicon-align-right'>");
                                                            $("#closeMess").css("display", "list-item");
                                                            $("#lltblMessage").append("Lanlord Deleted:</br> " + JSON.stringify(llproto));
                                                            $("#lltblMessage").after("</span>");
                                                            console.log("Inside else, Ready State: " + document.readyState);
                                                            //  console.log("Number of messages= " +numChildren);

                                                            $("#closeMess").on("click", function () {
                                                                $("#lltblMessage").hide();
                                                                $("#closeMess").hide();
                                                                currentState.needsDeletedMessage = false
                                                                messages.set(currentState);
                                                            });
                                                        }

                                                        needAddedMessage = false;
                                                    }

//    needAddedMessage=false;

//$("#loginBtn").on("click",function(){
//      testCall();
//                
//   });

                                                    function showHideForm() {
                                                        console.log("This is a test!! form 1");
                                                        $("#form1").toggle();
                                                        $("#addBtn").toggle();
                                                        if ($("#addBtn").attr("visibility") === "hidden") {
                                                            $("#addBtn").html("");
                                                            $("#lltblMessage").addClass("panel-success");
                                                        } else {
                                                            $("#addBtn").html("Add landlord</br>");
                                                            $("#lltblMessage").removeClass("panel-success");
                                                            //  $("#lltblMessage").html("");

                                                        }
                                                    }


                                                    $("#loginBtn").bind("click", function () {
                                                        console.log("This is  a test of click button");
                                                        console.log($("#userID").val());
                                                        user.email = $("#userID").val();
                                                        user.password = $("#password").val();
                                                    });
                                                    $(currentState).on("change", function () {
                                                        stateKeeper(currentState);
                                                    });
                                                    function stateKeeper(currentState) {
                                                        if (currentState.needsAddedMessage === true) {
                                                            handleMessage();
                                                            currentState.needsAddedMessage = false;
                                                            messages.set(currentState);
                                                        }
                                                        if (currentState.needsDeletedMessage === true) {
                                                            handleMessage();
                                                            currentState.needsDeletedMessage = false;
                                                            messages.set(currentState);
                                                        }
                                                    }

                                                    function deleteModal() {
                                                        var personToDelete = landlords.child(matched);
                                                        console.log("Index matched: " + matched);
                                                        currentState.needsDeletedMessage = true;
                                                        messages.set(currentState);
                                                        personToDelete.remove();
                                                        console.log("Message set" + JSON.stringify($(currentState)));
                                                        location.reload();
                                                        //  $("#lltblMessage").addClass("alert alert-success")
                                                        //  $("#lltblMessage").append("Record Deleted: " + JSON.stringify(llproto));

                                                    }


                                                    function getModal() {
                                                    var recordHtml = "  <tr> <td>First name</td>" +
                                                            " <td>  <input id = 'firstname' type='text' class='landlord' /></td>" +
                                                            "  </tr></br>" +
                                                            " <tr><td>Last Name</td> <td> <input id = 'lastname' type='text' class='landlord' /></td>" +
                                                            " </tr></br>  <tr>   <td>DOB</td>  <td> <input type='datetime-local' id = 'datebirth' type='text' class='landlord' /></td>" +
                                                            " </tr></br> <tr>  <td>Rating</td> <td> <input id = 'rating' type='range' class='landlord' min='1' max='10'/></td>" +
                                                            " </tr><tr> <td>Company</td><td><input id='company'  class='landlord' /></td>" +
                                                            "  </tr></br> <tr>   <td>Comments</td><td> <input id = 'comments' type='' class='landlord' /></td>" +
                                                            " </tr></br>";
                                                            var modalHtml = "<div id='modDetails' class='modal fade in'>" +
                                                            "<div class='modal-dialog'>" +
                                                            " <div class='modal-content'>" +
                                                            "<div class='modal-header'>" +
                                                            " <button type='button' class='close' data-dismiss='modal' aria-label='Close'><span aria-hidden='true'>&times;</span></button>" +
                                                            " <h4 class='modal-title'>" + llproto.firstname + " " + llproto.lastname +
                                                            "</h4>" +
                                                            " </div>" +
                                                            "<div class='modal-body'>" +
                                                            recordHtml +
                                                            //     "  <p>One fine body&hellip;</p>"+
                                                            " </div>" +
                                                            " <div class='modal-footer'>" +
                                                            "  <button id='modalClose' type='button' class='btn btn-default' data-dismiss='modal'>Close</button>" +
                                                            " <button id='modalSave' type='button' class='btn btn-primary'>Save changes</button>" +
                                                            " <button id='modalDelete' type='button' class='btn btn-warning'>Delete</button>" +
                                                            " </div>" +
                                                            "   </div><!-- /.modal-content -->" +
                                                            " </div><!-- /.modal-dialog -->" +
                                                            "</div><!-- /.modal -->";
                                                            $("#lltblMessage").append(modalHtml);
                                                            $("#lltblMessage").show();
                                                            $(".modal-body #firstname").val(llproto.firstname);
                                                            $(".modal-body #lastname").val(llproto.lastname);
                                                            $(".modal-body #datebirth").val(llproto.datebirth);
                                                            $(".modal-body #rating").val(llproto.rating);
                                                            $(".modal-body #company").val(llproto.company);
                                                            $(".modal-body #comments").val(llproto.comments);
                                                            var model = $("#modDetails").modal('show');
                                                            $(model).on('hidden.bs.modal', function (e) {
                                                    console.log("Everything should be hidden");
                                                            //  var related = $(this).prop("relatedTarget");
                                                            $(this).hide();
                                                            $(model).css("visibility", "hidden");
                                                            // $(related).prop("visibility, hidden");
                                                            $(model).attr("class", ".modal .fade .out");
                                                            console.log("relataed target" + $(model).attr("class"));
                                                    });
//                                                            $(model).on('shown.bs.modal', function (e) {
//                                                                console.log("Everything should be shown");
//                                                                //  var related = $(this).prop("relatedTarget");
//                                                                $(this).show();
//                                                                $(model).css("visibility", "visible");
//                                                                // $(related).prop("visibility, hidden");
//                                                                $(model).attr("class", ".fade .in");
//                                                                console.log("relataed target" + $(model).attr("class"));
//
//                                                            });



                                                            $("#modalSave").on("click", function () {
                                                    updateModal();
                                                            $(model).hide();
                                                            console.log("Clicking SAVE!...class is " + $(".modal-open").prop("class"));
                                                            $(".modal-dialog").hide();
//// TEST
                                                            $(this).hide();
                                                            $(model).css("visibility", "hidden");
                                                            // $(related).prop("visibility, hidden");
                                                            $(model).attr("class", ".modal .fade .out");
                                                            $(".modal-backdrop.in").attr("class", ".modal .fade .out");
                                                            console.log("relataed target" + $(model).attr("class"));
                                                    });
                                                            $("#modalDelete").on("click", function () {

                                                    getOKBox();
                                                    });
                                                            $("#modalClose").on("click", function () {
                                                    inModal = false;
                                                            $(model).hide();
                                                            console.log("Clicking save OK...class is " + $(".modal-open").prop("class"));
                                                            $(".modal-dialog").hide();
                                                    });
                                                    }


                                                    function getOKBox() {

                                                    var recordHtml = "<form id='okForm' class='alert alert-danger'> <tr> <td>First name</td>" +
                                                            " <td>  <input id = 'firstname' type='text' readonly='true' class='landlord' /></td>" +
                                                            "  </tr></br>" +
                                                            " <tr><td>Last Name</td> <td> <input id = 'lastname' type='text' readonly='true' class='landlord' /></td>" +
                                                            " </tr></br>  <tr>   <td>DOB</td>  <td> <input type='datetime-local' id = 'datebirth' type='text' readonly='true' class='landlord' /></td>" +
                                                            " </tr></br> <tr>  <td>Rating</td> <td> <input id = 'rating' type='range' readonly='true' class='landlord' min='1' max='10'/></td>" +
                                                            " </tr><tr> <td>Company</td><td><input id='company' readonly='true'  class='landlord' /></td>" +
                                                            "  </tr></br> <tr>   <td>Comments</td><td> <input id = 'comments' type='' readonly='true' class='landlord' /></td>" +
                                                            " </tr></br></form>";
                                                            var modalHtml = "<div class='modal fade'>" +
                                                            "<div class='modal-dialog alert alert-danger'>" +
                                                            " <div class='modal-content panel-warning'>" +
                                                            "<div class='modal-header'>" +
                                                            " <button type='button' class='close' data-dismiss='modal' aria-label='Close'><span aria-hidden='true'>&times;</span></button>" +
                                                            " <h4 class='modal-title'>This record will be deleted </br> Are you sure? --</br>" + llproto.firstname + " " + llproto.lastname +
                                                            "</h4>" +
                                                            " </div>" +
                                                            "<div class='modal-body'>" +
                                                            recordHtml +
                                                            //     "  <p>One fine body&hellip;</p>"+
                                                            " </div>" +
                                                            " <div class='modal-footer'>" +
                                                            "  <button id='modalClose' type='button' class='btn btn-default' data-dismiss='modal'>Cancel</button>" +
                                                            " <button id='okDelete' type='button' class='btn btn-warning'>Delete</button>" +
                                                            " </div>" +
                                                            "   </div><!-- /.modal-content -->" +
                                                            " </div><!-- /.modal-dialog -->" +
                                                            "</div><!-- /.modal -->";


                                                        $("#lltblMessage").append(modalHtml);
                                                        $("#okForm #firstname").val(llproto.firstname);
                                                        $("#okForm #lastname").val(llproto.lastname);
                                                        $("#okForm #datebirth").val(llproto.datebirth);
                                                        $("#okForm #rating").val(llproto.rating);
                                                        $("#okForm #company").val(llproto.company);
                                                        $("#okForm #comments").val(llproto.comments);
                                                            
                                                        var model = $(".modal").modal('show');
                                                           $("#lltblMessage").show();


                                                        $("#okDelete").on("click", function () {
                                                            deleteModal();
                                                            $(model).hide();
                                                            $(".modal-dialog").hide();
                                                            console.log("Clicking DELETE OK...class is " + $(".modal-open").prop("class"));
////location.reload();
                                                            $(".modal-backdrop.in").attr("class", ".modal .fade .out");

                                                        });


                                                        $("#modalClose").on("click", function () {
                                                            $(model).hide();
                                                            console.log("Clicking save OK...class is " + $(".modal-open").prop("class"));
                                                            $(".modal-dialog").hide();

                                                        });

                                                    }


//////retrieved on click so it can be matched before any edits
                                                    function findCell(valToMatch) {
                                                        //could use table.rows[1...rowIndex]
                                                        var rowArr = table[0].children[1].rows;
                                                        for (var a in rowArr) {
                                                            if (a.rowIndex === $(valToMatch)) {
                                                                var indexMatched = this.rowIndex;
                                                                // indexMatched = Array.indexOf(a);
                                                                console.log("matched values in row " + valToMatch.contentText + "index is " + indexMatched);
                                                                return indexMatched;
                                                            } else {
                                                                console.log("This val " + valToMatch.contentText + "did not match key " + a.indexMatched);

                                                            }

                                                        }
                                                    }



function go() {
var userId = prompt('Username?', $("#userId").val());
checkIfUserExists(userId);
}

var USERS_LOCATION = 'https://slumlordrateboard.firebaseio.com';

function userExistsCallback(userId, exists) {
if (exists) {
alert('user ' + userId + ' exists!');
return true;
} else {
alert('user ' + userId + ' does not exist!');
return false;
}
}

//// Tests to see if /users/<userId> has any data. 
function checkIfUserExists(userId) {
var usersRef = new Firebase(USERS_LOCATION);
usersRef.child(userId).once('value', function(snapshot) {
var exists = (snapshot.val() !== null);
userExistsCallback(userId, exists);
});
}
//////
function authenticateUser(){
if( go()===true){
          console.log("In true of auth go is true");

ref = new Firebase("https://slumlordrateboard.firebaseio.com");
ref.authWithPassword({
"email": $("#userID").val(),
"password": $("#password").val()
}, function(error, authData) {
if (error) {
console.log("Login Failed!", error);
} else {
console.log("Authenticated successfully with payload:", authData);
}
});
}
}

function authenticateMessages(){
messages  = ref.child("landlords").child("messages");
messages.authWithPassword({
email    : $("#userID").val(),
 
password : $("#password").val()
  
}, authHandler);
}

                                                    function getLogin() {
                                                        var recordHtml = "  <div class='logmod'>"+
"<div class='logmod__wrapper'>"+
    "<div class='logmod__container'>"+
  "<ul class='tab logmod__tabs'>"+
  "</ul>"+
  "<div class='logmod__tab-wrapper'>"+
  "<div data-toggle='tab' class='active logmod__tab lgm-1'>"+
    "<div class='logmod__heading'>"+
      "<span class='logmod__heading-subtitle'>Enter your personal details <strong>to create an acount</strong></span>"+
    "</div>"+
    "<div class='logmod__form'>"+
      "<form accept-charset='utf-8' action='#' class='simform'>"+
        "<div class='sminputs'>"+
          "<div class='input full'>"+
            "<label class='string optional' for='user-name'>Email*</label>"+
            "<input class='string optional' maxlength='255' id='user-email' placeholder='Email' type='email' size='50' />"+
          "</div>"+
        "</div>"+
        "<div class='sminputs'>"+
          "<div class='input string optional'>"+
            "<label class='string optional' for='user-pw'>Password *</label>"+
            "<input class='string optional' maxlength='255' id='user-pw' placeholder='Password' type='text' size='50' />"+
          "</div>"+
          "<div class='input string optional'>"+
            "<label class='string optional' for='user-pw-repeat'>Repeat password *</label>"+
            "<input class='string optional' maxlength='255' id='user-pw-repeat' placeholder='Repeat password' type='text' size='50' />"+
          "</div>"+
        "</div>"+
        "<div class='simform__actions'>"+
          "<input class='sumbit' name='commit' type='sumbit' value='Create Account' />"+
          "<span class='simform__actions-sidetext'>By creating an account you agree to our <a class='special' href='#' target='_blank' role='link'>Terms & Privacy</a></span>"+
        "</div>"+ 
      "</form>"+
    "</div>"+ 
    "<div class='logmod__alter'>"+
      "<div class='logmod__alter-container'>"+
           
              
        "<a href='#' class='connect googleplus'>"+
          "<div class='connect__icon'>"+
            "<i class='fa fa-google-plus'></i>"+
          "</div>"+
          "<div class='connect__context'>"+
            "<span>Create an account with <strong>Google+</strong></span>"+
          "</div>"+
        "</a>"+
      "</div>"+
    "</div>"+
  "</div>"+
     
  "<div data-toggle='tab' class='logmod__tab lgm-2'>"+
    "<div class='logmod__heading'>"+
      "<span class='logmod__heading-subtitle'>Enter your email and password <strong>to sign in</strong></span>"+
    "</div>"+ 
    "<div class='logmod__form'>"+
      "<form accept-charset='utf-8' action='#' class='simform'>"+
        "<div class='sminputs'>"+
          "<div class='input full'>"+
            "<label class='string optional' for='user-name'>Email*</label>"+
            "<input class='string optional' maxlength='255' id='user-email' placeholder='Email' type='email' size='50' />"+
          "</div>"+
        "</div>"+
        "<div class='sminputs'>"+
          "<div class='input full'>"+
            "<label class='string optional' for='user-pw'>Password *</label>"+
            "<input class='string optional' maxlength='255' id='user-pw' placeholder='Password' type='password' size='50' />"+
                                                            "<span class='hide-password'>Show</span>"+
          "</div>"+
        "</div>"+
        "<div class='simform__actions'>"+
          "<input class='sumbit' name='commit' type='sumbit' value='Log In' />"+
          "<span class='simform__actions-sidetext'><a class='special' role='link' href='#'>Forgot your password?<br>Click here</a></span>"+
        "</div>"+ 
      "</form>"+
    "</div>"+ 
    "<div class='logmod__alter'>"+
      "<div class='logmod__alter-container'>"+
        "<a href='#' class='connect facebook'>"+
          "<div class='connect__icon'>"+
            "<i class='fa fa-facebook'></i>"+
          "</div>"+
          "<div class='connect__context'>"+
            "<span>Sign in with <strong>Facebook</strong></span>"+
          "</div>"+
        "</a>"+
        "<a href='#' class='connect googleplus'>"+
          "<div class='connect__icon'>"+
            "<i class='fa fa-google-plus'></i>"+
          "</div>"+
          "<div class='connect__context'>"+
            "<span>Sign in with <strong>Google+</strong></span>"+
          "</div>"+
        "</a>"+
      "</div>"+
    "</div>"+
      "</div>"+
  "</div>"+
"</div>"+
"</div>"+
"</div>";



                                                        var modalHtml = "<div class='modal fade'>" +
                                                                "<div class='modal-dialog'>" +
                                                                " <div class='modal-content'>" +
                                                                "<div class='modal-header'>" +
                                                                " <button type='button' class='close' data-dismiss='modal' aria-label='Close'><span aria-hidden='true'>&times;</span></button>" +
                                                                " <h4 class='modal-title'> Login" +
                                                                "</h4>" +
                                                                " </div>" +
                                                                "<div class='modal-body'>" +
                                                                recordHtml +
//                                                                    //     "  <p>One fine body&hellip;</p>"+
                                                                " </div>" +
                                                                " <div class='modal-footer'>" +
                                                                "  <button id='modalClose' type='button' class='btn btn-default' data-dismiss='modal'>Close</button>" +
                                                                " <button id='modalSignin' type='button' class='btn btn-primary'>Log in</button>" +
                                                                " </div>" +
                                                                "   </div><!-- /.modal-content -->" +
                                                                " </div><!-- /.modal-dialog -->" +
                                                                "</div><!-- /.modal -->";

ref = rootRef;
                                                        $("#lltblMessage").append(modalHtml);
////                                                            $(".modal-body #firstname").val(llproto.firstname);
////                                                            $(".modal-body #lastname").val(llproto.lastname);
////                                                            $(".modal-body #datebirth").val(llproto.datebirth);
////                                                            $(".modal-body #rating").val(llproto.rating);
////                                                            $(".modal-body #company").val(llproto.company);
////                                                            $(".modal-body #comments").val(llproto.comments);
////                                                            ;
                                                        var model = $(".modal").modal('show');

////                                                            $(model).on('hidden.bs.modal', function (e) {
////                                                                console.log("Everything should be hidden");
////                                                                //  var related = $(this).prop("relatedTarget");
////                                                                $(this).hide();
////                                                                $(model).css("visibility", "hidden");
////                                                                // $(related).prop("visibility, hidden");
////                                                                $(model).attr("class", ".modal .fade .out");
////                                                                console.log("relataed target" + $(model).attr("class"));
////
////                                                            });



                                                        $("#modalSignin").on("click", function () {
                                                              
                                                            $(model).hide();
                                                            console.log("Clicking log in! " + $(".modal-open").prop("class"));
                                                            $(".modal-dialog").hide();


                                                        });
                                                    }


$("#myBtn").on("click",function(){
        console.log("Login button clicked");

$("#loginModal").css("visibility","visible");
      $("#myModal").modal();
$("#myModal").css("visibility","visible");
    
    
});

$("#myBtn").click(function(){
    console.log("Login button clicked");
    $("#loginModal").modal();
});
//    
//   
//    
function authDataCallback(authData) {
if (error===null) {
 $(authData).change();
console.log("User " + authData.uid + " is logged in with " + authData.provider);
user.uid = authData.uid;
 user.email = authData.password.email;
  
//createNewUser(user);
} else {
  error=error;
console.log("User is logged out" + error);
    
//   // authData = {};
}
}

$("#loginBtn").bind("click",function(){
                                                            console.log("This is  a test of click button");
                                                            console.log($("#userID").val());
                                                            user.email= $("#userID").val();
                                                            user.password= $("#password").val();
                                                            //testUser();
                                                         //testCall();
                                                         loginOptions(3);
                                                         authenticateMessages();
                                                        });
                                                         $("#password").bind("value",function(){
                                                            console.log($(this).val());
                                                            user.password= $(this).val();
                                                               
                                                        });
                                                        // Register the callback to be fired every time auth state changes


// Create a callback which logs the current auth state
function logout(){
    if(authData){
    ref.unauth();
     location.reload();
    } else{
    console.log("User already logged out");
}
}

//// Register the callback to be fired every time auth state changes


var isNewUser = true;

//// Create a callback to handle the result of the authentication
function authHandler(error, authData) {
if (error && authData === null) {
console.log("Login Failed!", error);
error = error;
} else {
         location.reload();
 authData = authData;
 user.uid = authData.uid;
 user.email = authData.password.email;
 console.log("Authenticated successfully with payload:", authData + " uid: " + authData.uid);
  
                                                              if(users.uid===null){
                                                             users.set(user.uid);
                                                                                                                                                   

                                                                   }else{
                                                           users.child(user.uid).set(user);
                                                           
                                                                         }
                                                                                                                                                  
                                                                                
                                                      

 //createNewUser(user);

}
}

function loginOptions(option){
  ref = rootRef;
console.log("UsserID set: " + $("#userID").val() + "password set: " + $("#password").val());
if(option===1){
// Authenticate users with a custom authentication token
ref.authWithCustomToken("<token>", authHandler);
}
else if(option===2){
// Alternatively, authenticate users anonymously
ref.authAnonymously(authHandler);
}
else if(option===3){
////        var callback;
////        if(getUserIdByEmail($("#userID").val(),callback)===null){
////            createNewUser($("#userID").val());
////        }
//// Or with an email/password combination
ref.authWithPassword({
email    : $("#userID").val(),
 
password : $("#password").val()
  
}, authHandler);

}else if(option===4){
        

////// Or via popular OAuth providers ("facebook", "github", "google", or "twitter")
ref.authWithOAuthPopup("<provider>", authHandler);

}else if(option===5){
ref.authWithOAuthRedirect("<provider>", authHandler);

}else{
    console.log("no options givem, login not attempted!")
}

}





                               //                             alerts=users.child(authData.uid).set(alerts);
                                                           users.on("value",function(snapshot){
                                                               userData = snapshot.val();
                                                               if(authData !==null ){
                                                                 
                                                                   if($(userData).index(user.uid)===null || 'undefined'){
                                                                   user= snapshot.val()[user.uid];
//                                                                   user.alerts=[];
//                                                                   if(alerts!==null){
//                                                                   user.alerts.push(alerts); 
//                                                                    }
//                                                                    for(var x in user)
//                                                                        for(var y in user.x){
//                                                                    if(y[0].length!=null){
//                                                                        $(this).removeProp("length");
//                                                                    }
//                                                                }
//                                                                   // user(authData);
                                                                       var saveuid= user.uid;
                                                                    //jQuery.merge(user,authData);
                                                                    user=authData;
                                                                    user.uid=saveuid;
                                                                    
                                                                    //create and push the authenticated user in db\
                                                                    users.child(user.uid).set(user);
                                                                   
                                                                     }else{
                                                                         
                                                                         user= userData[user.uid];
                                                                     }
                                                                                  
                                                                     }else{
                                                                     //this user is not authenticated
                                                                     console.log("this user is not authenticated, guest user");

                                                                          }
                                                                                                                                                  
                                                      
                                                                                                                                                
                                                                                //console.log("Logged in and alerts should be set for this user" + user.uid);
                                                                                                                                                  
                                                                                                                                           
                                                                                     

                                                             });










function testCall(){

ajaxTest(user.email,user.password);
}
function ajaxTest(email,pwd){
var reqUrlBase = "https://auth.firebase.com/v2/slumlordrateboard/auth/password?";
$.getJSON(reqUrlBase,{
    email: email,
    password: pwd,
    v: "js-2.3.0",
    transport: "JSON"
                
}
            
        ).done(authDataCallback);
             
}

function testLogin(){
    
$.ajax(
rootRef.authWithPassword({
email    : "admin@slumlordrateboard.firebaseapp.com",
 
password : "smellyou"
}, function(error, authData){
    
if (error) {
console.log("Login Failed!", error);
} else {
console.log("Authenticated successfully with payload:", authData + " uid: " + authData.uid);
}
}
));

}

function testUser(){
ref.authWithPassword({
 email : user.email,
password : user.password

},authDataCallback);
}

var fb = users;

function createNewUser(user) {
                                      //  var callback;
                                                                   
                                                                                                                                          var ref = rootRef;
                                                                                                                                          ref.createUser({
                                                                                                                                              email: $("#signupModal").find("#userID").val(),
                                                                                                                                              password: $("#signupModal").find("#password").val()
                                                                                                                                          }, function(error, userData) {
                                                                                                                                              if (error) {
                                                                                                                                                  console.log("Error creating user:", error);
                                                                                                                                                  getAlertMessage("Sign up Error", "Error creating user:" + error, "Try again?", $('#signupModal').modal('show'));

                                                                                                                                              } else {
                                                                                                                                                  console.log("Successfully created user account with uid:", userData.uid);
                                                                                                                                                  loginOptions(3);
                                                                                                                                                  getAlertMessage("Success", "User created:" + user.email, "Login now?", $('#loginModal').modal('show'));
                                                                                                                                                    jQuery.merge($(user.alerts),$("#messagelist").find("li").text());
                                                                                                                                              //  $(user.alerts).push($("#messagelist").find("li").text());
                                                                                                                                                  user.uid = userData.uid;

                                                                                                                                                  var id = users.set(user.uid);
                                                                                                                                                  
                                                                                                                                                  users.child(user.uid).set(user);
                                                                                                                                                
                                                                                                                                                  console.log("User ID created" + user.uid);
                                                                                                                                                //   if (id!== null){return id};
                                                                                                                                              }
                                                                                                                                          });



                                                                                                                                         
                                                                                                                                      }

                                                                                                                                  
/**
* Firebase keys cannot have a period (.) in them, so this converts the emails to valid keys
*/
function emailToKey(emailAddress) {
return emailAddress.replace(/\./g, ',');
}


/**
* Looks up a user id by email address and invokes callback with the id or null if not found
* @return {Object|null} the object contains the key/value hash for one user
*/
function getUserIdByEmail( emailAddress) {
fb.child('uid/'+emailToKey(emailAddress)).once('value', function(snap) {
   callback( snap.val() );
});
   
}
   


$(authData).bind("change",function(){
if (authData!==null) {
   $("#logoutBtn").show();
   $("#myBtn").hide();
console.log("User " + authData.uid + " is logged in with " + authData.provider);
$("#loginStateMsg").val("User, " + authData.password.email + " is logged in.");
} else {
 $("#logoutBtn").hide();
 $("#myBtn").show();
console.log("User is logged out");
$("#loginStateMsg").val("Please log in.");

}
});

$('#getSignupBtn').click(function(){
    inModal=true;
    console.log("signup button clicked!");
    $("#loginModal").modal('hide');
        
// $("#myModal").css("visibility","hidden");
$('.modal-backdrop').css("visibility","hidden");
    
//        $('#signupModal').modal();
//
//         $('#signupModal').css("visibility","visible");
//
//    

$("#signupModal").css("visibility","visible");
      $("#signup").modal();
$("#signup").css("visibility","visible");
    
});

$('#signupBtn').click(function(){
    console.log("signup button clicked!");
    $("#loginModal").modal('hide');
        
// $("#myModal").css("visibility","hidden");
$('.modal-backdrop').css("visibility","hidden");
    
//        $('#signupModal').modal();
//
//         $('#signupModal').css("visibility","visible");
//
//    

$("#signupModal").css("visibility","hidden");
    //  $("#signup").modal();
$("#signup").css("visibility","hidden");
    user.email = $("#signupModal #userID").val();
    user.password = $("#signupModal #password").val();
    console.log("userid and password set, createNewUser being called user id:"+ user.email + "password" + user.password);
createNewUser(user);
    
});
   
function getAlertMessage(title, description, buttonText,url){
   var btnId= jQuery.trim(buttonText);
   var str= makeId(btnId);
   var numMsgs= $("#messageList").find("li") === null || 'undefined' ? 0 : $("#messageList")[0].childElementCount;
 //  var btnIdArr=btnId.split(" ");
  // btnId=""
  

//if($("#messageList")[0]===null ||$("#messageList")[0]==='undefined'){
//   numMsgs = 0;
//}else{
//   numMsgs = $("#messageList")[0].childElementCount;
//}

btnId="#" + str;
    
   console.log("btnId converted to: " + str);
   var baseHtml = "  <li id=li"+str + numMsgs + " class='alert-danger'><button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>×</span></button>"+
 " <h4>"+title+"</h4>"+
 " <p>"+description+"</p>"+
   " <button id='"+ str +"' type='button' class='btn btn-danger'>"+buttonText+"</button>"+
 " </p></li>";
     
 $("#messageList").append(baseHtml);
                    $("#" + str).click(function(url) {
                   // location.redirect("+url+");
                    console.log("click event attached for new alert: " + buttonText);
                   // $(document).redirect(url)
                    eval(url());
                                                });
                                                
                                                
        if(authData!==null){
        // $(user).alerts.push($("#li"+str + numMsgs).data());
                 user.alerts={}                                 
        user.alerts[$(user.alerts).length]=($("#li"+str + numMsgs).text());
        if(!$(userData[user.uid]).hasOwnProperty("alerts")){

        }

          users.child(user.uid).set(user);
                                                }


//$( "#li"+str + numMsgs).hover(function(){
//    $(this).final();
//    $(this).fadeIn();
//    
//});
//
//$( "#li"+str + numMsgs).mouseleave(function(){
//  $( "#li"+str + numMsgs).animate({
//visibility: [ "hidden", "swing" ],
//opacity: "0"}
//, 10000, "linear", function() {
//$(  this ).hide();
//}
//);
//    
//});
//                                                                        
  
$( "#li"+str + numMsgs).animate({
visibility: [ "hidden", "swing" ],
opacity: "0"}
, 10000, "linear", function() {
$(  this ).hide();
}
)
.hover(function(){
    $(this).final();
    $(this).fadeIn();
    
}).mouseleave(function(){
  $(this).animate({
visibility: [ "hidden", "swing" ],
opacity: "0"}
, 10000, "linear", function() {
$(  this ).hide();
}
);
    
});
   
   
   
   
   return  $("#messageList");
       
}
   
   
//      $( "#li"+str + numMsgs").animate({
//    visibility: [ "hidden", "swing" ],
//    height: [ "0px", "swing" ],
//    opacity: "toggle"}
//  , 5000, "linear", function() {
//    $(  "#"+str ).after( "<div>Animation complete.</div>" );
//});
//   function alertQueue(elem){
//      console.log("animating now!" + $(this));
//    $(elem).children("*", function(){
//        console.log("animating now!" + $(this));
//        $( elem ).animate({
//    width: [ "toggle", "swing" ],
//    height: [ "toggle", "swing" ],
//    opacity: "toggle"
//  }, 5000, "linear", function() {
//    $( elem ).after( "<div>Animation complete.</div>" );
//  });
//      
//    
//});
//}
//


  function makeId(str){
var str= str.replace(" ","");
var str= str.replace("?","");
var str= str.replace("!","");
var str= str.replace(".","");
var str= str.replace("=","");
var str= str.replace("(","");
var str= str.replace(")","");
var str= str.replace("{","");
var str= str.replace("}","");
var str= str.replace("-","");
var str= str.replace("&","");
var str= str.replace("@","");
var str= str.replace("$","");
var str= str.replace("%","");
var str= str.replace("^","");
var str= str.replace("+","");
var str= str.replace("-","");
var str= str.replace(":","");
var str= str.replace(">","");
var str= str.replace("<","");
var str= str.replace(",","");
var str= str.replace("[","");
var str= str.replace("]","");
var str= str.replace("'","");
return str;
  }
  
  
  $( "*" ).error(function(){
      getAlertMessage("Error Message", $(this).val(), "OK",$(this).parent("li").hide());
  });
  
  
    </script>
</body>
<footer id='footer' class="navbar-fixed-bottom ">

    <ul id="messageList" class="alert alert-danger alert-dismissible fade.in" hidden='true' role="alert" >

    </ul>  


    <!--              <ul id="messageList" class="alert alert-danger alert-dismissible fade in" role="alert" >
                                <li class="alert-danger"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span></button>
              <h4>Oh snap! You got an error!</h4>
              <p>Change this and that and try again. Duis mollis, est non commodo luctus, nisi erat porttitor ligula, eget lacinia odio sem nec elit. Cras mattis consectetur purus sit amet fermentum.</p>
                <button type="button" class="btn btn-danger">Take this action</button>
              </p></li>
                  </ul>-->
</footer>
</html>







